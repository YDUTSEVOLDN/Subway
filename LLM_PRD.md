## **智能交通监控与调度平台 - LLM 功能增强模块需求规格说明书 (PRD)**

**版本**: 1.0
**日期**: 2024年7月16日
**文档状态**: 草案

### **1. 项目概述与目标**

#### 1.1 项目背景

当前的智能交通监控与调度平台已经具备了强大的数据可视化、路径规划和调度管理能力。为了进一步提升系统的智能化水平、优化用户操作流程并挖掘数据深层价值，我们计划引入大型语言模型（LLM），将前沿的人工智能技术与核心业务场景深度融合。

#### 1.2 核心目标

1.  **提升效率**：将繁琐的手动数据录入和分析操作，转变为由LLM驱动的“一键生成”和自动化流程，大幅节省用户时间。
2.  **增强智能**：利用LLM的自然语言理解和内容生成能力，为调度决策提供超越原始数据的、更具洞察力的辅助信息。
3.  **革新交互**：引入自然语言作为系统新的交互方式，降低用户使用门槛，让复杂功能的调用像聊天一样简单自然。

### **2. 功能模块一：智能调度方案生成与解读**

#### 2.1 功能描述

在“路径规划”页面，当用户成功生成一条调度路径后，系统将自动调用LLM，根据路径的各项参数（如起终点、供需状况、距离、时间等），生成一份结构化的、可以直接采纳的调度方案文本。

#### 2.2 功能规格 (Specifications)

*   **触发时机**：用户在“路径规划”页面点击“查看详情”或“生成路径”并成功获取到路径规划结果后。
*   **输入数据 (to LLM)**：
    *   起点站名称、经纬度、当前供需状态（如：富余/Surplus）。
    *   终点站名称、经纬度、当前供需状态（如：短缺/Shortage）。
    *   计划调度的单车数量。
    *   规划出的路径总距离（米）、预计耗时（分钟）。
    *   路径途径的主要道路名称列表（可选，但能极大提升生成质量）。
    *   当前时间或计划执行时间。
*   **输出内容 (from LLM)**：系统需在前端界面以清晰的卡片或文本区域展示以下由LLM生成的内容：
    1.  **方案名称 (Title)**：一个简洁、概要的标题。
        *   *示例：* `“晚高峰应急：从安定门向东直门紧急增援”`
    2.  **执行摘要 (Summary)**：一段包含核心要素的描述性文本。
        *   *示例：* `“本次任务计划于 18:00 执行，从单车富余的【安定门】站...向车辆严重短缺的【东直门】站调配 15 辆单车...旨在缓解东直门枢纽站晚高峰的用车压力。”`
    3.  **风险提示 (Risk Hint)**：一句基于地理位置或时间的潜在风险提醒。
        *   *示例：* `“注意：路径将经过雍和宫大街，该路段傍晚时段游客较多，可能出现拥堵，请调度员预留出额外时间。”`
*   **用户交互**：
    *   生成的内容应允许用户进行二次编辑。
    *   提供“采纳并保存到调度计划”按钮，点击后将上述生成文本连同路径数据一并存入“调度方案”列表。

#### 2.3 技术考量

*   **前端** (`PathPlanner.vue`): 负责在获取路径后，打包数据并调用新的后端API。
*   **后端**: 需新增一个API端点 (`/api/llm/generate-dispatch-summary`)，负责与LLM服务进行交互。
*   **Prompt工程**: 核心是设计高质量的Prompt，引导LLM稳定地按要求格式输出内容。

### **3. 功能模块二：全局自然语言查询与指令**

#### 3.1 功能描述

在系统界面提供一个全局、随时可用的自然语言入口（如顶部的搜索框或浮动聊天按钮）。用户可以通过输入自然语言，实现对系统数据的查询、对功能的调用以及对复杂分析的请求。

#### 3.2 功能规格 (Specifications)

该功能按用户意图可分为三类：

*   **A. 事实性问答 (Q&A)**
    *   **用户输入**: `“今天哪个站点的单车缺口最大？”`
    *   **系统响应**: 在UI上给出直接的文本答案，并可附带链接。`“截至目前，单车缺口最大的站点是【西二旗】，缺少约 58 辆车。 [点击查看地图]”`
    *   **覆盖范围**: 系统应能回答关于站点流量、单车供需、调度计划状态等核心数据的查询。

*   **B. 指令式操作 (Command)**
    *   **用户输入**: `“帮我规划一条从西单到国贸的调度路线，需要20辆车”`
    *   **系统响应**: 不返回文本，而是直接执行操作——跳转到“路径规划”页面，并自动填充好起点（西单）、终点（国贸）和调度数量（20）。
    *   **覆盖范围**: 应支持创建路径规划、创建调度方案、查询特定用户等指令。

*   **C. 分析式请求 (Analysis)**
    *   **用户输入**: `“对比一下五道口和中关村上周的客流量趋势”`
    *   **系统响应**: 执行复杂操作——跳转到“数据分析”的“站点对比”视图，并自动选中“五道口”和“中关村”，设定好日期范围为“上周”，然后渲染出对比图表。
    *   **覆盖范围**: 支持多站点对比、趋势分析、排名查询等。

#### 3.3 技术考量

*   **前端**:
    *   需要一个全局的输入组件。
    *   需要一个能够解析后端返回的多种格式响应（文本、跳转指令、视图填充指令）并执行相应UI操作的逻辑处理器。
*   **后端**:
    *   需要一个统一的LLM代理入口 (`/api/llm/query-agent`)。
    *   **核心技术是 Function Calling**：LLM需要被训练或通过Prompt引导，使其能将用户的自然语言，准确地映射到系统内部已有的服务函数上（如 `getBikeStatusForAllStations`, `getStationComparisonData` 等）。
    *   需要一个“意图路由器”，根据LLM的解析结果，调用正确的内部服务，并封装好返回给前端的指令。

### **4. 非功能性需求**

*   **性能**: LLM的调用会引入额外延迟。单次交互的端到端响应时间应尽量控制在3秒以内。前端需有明确的“思考中...”或加载状态提示。
*   **成本**: LLM API调用会产生费用。需对调用频率进行监控，并在后端设置必要的限流或缓存机制。
*   **准确性**: 对LLM的输出结果不能100%信任。特别是Function Calling的参数提取，需要有严格的校验和错误处理机制。

### **5. 验收标准**

*   **模块一**:
    *   [ ] 在路径规划页，能为任意起终点成功生成包含三要素（名称、摘要、提示）的调度方案文本。
    *   [ ] 生成的文本内容逻辑通顺，与输入的路径数据高度相关。
    *   [ ] 生成的方案可以被成功保存到“调度方案”列表。
*   **模块二**:
    *   [ ] 能正确回答至少5种不同类型的数据查询问题。
    *   [ ] 能正确执行至少3种不同类型的页面跳转和数据填充指令。
    *   [ ] 对于无法理解或无法执行的输入，能给出友好、清晰的提示（如：“抱歉，我暂时无法理解这个指令，请换一种方式提问。”）。

--- 